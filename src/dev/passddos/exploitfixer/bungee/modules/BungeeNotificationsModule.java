package dev._2lstudios.exploitfixer.bungee.modules;

import java.util.logging.Logger;

import dev._2lstudios.exploitfixer.shared.modules.NotificationsModule;
import net.md_5.bungee.api.CommandSender;
import net.md_5.bungee.api.ProxyServer;
import net.md_5.bungee.api.chat.BaseComponent;
import net.md_5.bungee.api.chat.TextComponent;
import net.md_5.bungee.api.connection.ProxiedPlayer;

public class BungeeNotificationsModule extends NotificationsModule {
	private final CommandSender console;
	private final ProxyServer server;

	public BungeeNotificationsModule(final CommandSender console, final Logger logger, final ProxyServer server) {
		super(logger);
		this.console = console;
		this.server = server;
	}

	public void sendNotification(final String check, final ProxiedPlayer player, final int violations) {
		if (isEnabled() && player != null) {
			final BaseComponent[] notification = TextComponent.fromLegacyText(getMessage()
					.replace("%player%", player.getName()).replace("%check%", check)
					.replace("%ping%", String.valueOf(player.getPing())).replace("%vls%", String.valueOf(violations)));

			console.sendMessage(notification);

			for (final String playerName : getNotifications()) {
				final ProxiedPlayer player2 = server.getPlayer(playerName);

				if (player2 != null) {
					player2.sendMessage(notification);
				}
			}
		}
	}
}
